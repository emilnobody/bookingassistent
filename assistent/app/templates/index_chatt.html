<!DOCTYPE html>
<html>
  <head>
    <title>Chat with GPT</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      /* Standardmäßig ist die Ladeanzeige ausgeblendet */
      /* .d-none {
        display: none;
      } */

      /* Sobald das Formular abgesendet wird, zeigt sich die Ladeanzeige */
      /* form:valid #loadingMessage {
        display: block;
      } */
    </style>
  </head>
  <body class="bg-light min-vh-100 d-flex flex-column">
    <div class="container py-5 flex-grow-1 d-flex flex-column">
      <div class="row justify-content-center flex-grow-1">
        <div class="col-12 col-md-8 col-lg-6 d-flex flex-column">
          <h1 class="text-center mb-5 text-primary">Buchungsassistent</h1>

          {% if error %}
          <div class="alert alert-danger mb-4" role="alert">{{ error }}</div>
          {% endif %}

          <div
            id="chatContainer"
            class="flex-grow-1 overflow-auto mb-4"
            style="max-height: 60vh"
          >
            {% for message in messages %}
            <div
              class="d-flex {{ 'justify-content-end' if message.is_user else 'justify-content-start' }} mb-3"
            >
              <div class="card shadow-sm border-0" style="max-width: 75%">
                <div class="card-body">
                  <div class="mb-2">
                    <h3 class="h6 text-primary">
                      {{ 'You' if message.is_user else 'Assistent' }}:
                    </h3>
                    <p class="mb-0 ps-3">
                      {{ message.q if message.is_user else message.a }}
                    </p>
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>

          <div class="d-flex gap-2">
            <form id="chatForm" method="POST" action="/" class="flex-grow-1">
              <div class="input-group">
                <input
                  type="text"
                  name="message"
                  class="form-control form-control-lg rounded-start"
                  placeholder="Write your message here..."
                  required
                />
                <button type="submit" class="btn btn-primary btn-lg">
                  Send
                </button>
                <div
                  id="loadingMessage"
                  class="text-center text-muted mt-2 d-none"
                >
                Wird bearbeitet...
                </div>
              </div>
            </form>
            <form method="POST" action="/reset">
              <button type="submit" class="btn btn-outline-secondary btn-lg">
                New
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Funktion zum Scrollen ans Ende des Chat-Fensters
      function scrollToBottom() {
        var chatContainer = document.getElementById("chatContainer");
        chatContainer.scrollTop = chatContainer.scrollHeight;
      }

      // Scrollen beim Laden der Seite
      window.onload = scrollToBottom;

      // Scrollen nach jeder Eingabe (kleine Verzögerung für reibungslosen Effekt)
      setTimeout(scrollToBottom, 100);
      // Formularabsendefunktion
      document
        .getElementById("chatForm")
        .addEventListener("submit", function (e) {
          // Ladeanzeige anzeigen
          document.body.classList.add("is-sending");
        });
    </script>
  </body>
</html>
